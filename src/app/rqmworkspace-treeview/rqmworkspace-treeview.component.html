<!-- 
openrqm-client-desktop-nwjs
RQMWorkspaceTreeView Component Template
SPDX-License-Identifier: GPL-2.0-only
Copyright (C) 2019 Benjamin Schilling
-->

<ng-template #propertiesModal let-modal>
  <div class="modal-header">
    <h4 *ngIf="tempTreeViewItem.isDocument " class="modal-title pull-left">Document Properties</h4>
    <h4 *ngIf=" !tempTreeViewItem.isDocument " class="modal-title pull-left">Workspace Properties</h4>
    <button type="button" class="close pull-right" aria-label="Close" (click)="modal.dismiss('Cross click')">
                  <span aria-hidden="true">&times;</span>
              </button>
  </div>
  <app-rqmworkspace-treeview-item-properties [item]=tempTreeViewItem (logoutEvent)="modal.dismiss('Cross click')"></app-rqmworkspace-treeview-item-properties>
</ng-template>

<ng-template #deleteModal let-modal>
  <div class="modal-header">
    <h4 *ngIf="tempTreeViewItem.isDocument " class="modal-title pull-left">Delete Document</h4>
    <h4 *ngIf=" !tempTreeViewItem.isDocument " class="modal-title pull-left">Delete Workspace</h4>
    <button type="button" class="close pull-right" aria-label="Close" (click)="modal.dismiss('Cross click')">
                  <span aria-hidden="true">&times;</span>
              </button>
  </div>
  <div class="modal-footer">
    <button *ngIf=" tempTreeViewItem.isDocument " mat-raised-button (click)="deleteDocument(tempTreeViewItem)">Confirm</button>
    <button *ngIf=" !tempTreeViewItem.isDocument " mat-raised-button (click)="deleteWorkspace(tempTreeViewItem)">Confirm</button>
  </div>
</ng-template>

<ng-template #itemTemplate let-item="item" let-onCollapseExpand="onCollapseExpand" let-onCheckedChange="onCheckedChange">
  <div class="form-inline row-item" ngbDropdown #treeViewDropdown="ngbDropdown" (click)="onCollapseExpand() " (contextmenu)="onContextMenu($event, treeViewDropdown);">
    <!-- If the item has children a black folder icon shall be displayed -->
    <fa-icon *ngIf=" item.children " aria-hidden="true " [icon]="item.collapsed ? faFolder : faFolderOpen "></fa-icon>
    <!-- If the item is a document a file icon shall be displayed -->
    <fa-icon *ngIf="item.isDocument " [icon]="faFile "></fa-icon>
    <!-- If the item is not a document and does not has children, a white folder shall be displayed -->
    <fa-icon *ngIf="!item.isDocument && !item.children " [icon]="faFolderRegular "></fa-icon>
    <!-- On click the select method with the item as a parameter is called, the text of the item and the ID are displayed (the ID only for debug purposes) -->
    <label class="form-check-label " (click)="select(item) " id="treeviewObjectDropdown " ngbDropdownAnchor>
        {{ item.text }}
        </label>
    <!-- Dropdown when clicking on a treeview item -->
    <div ngbDropdownMenu aria-labelledby="dropdownManual" autoClose="true">
      <button *ngIf="item.isItemWorkspace() " ngbDropdownItem (click)="openDialogNewWorkspace(item)">Add Workspace</button>
      <button *ngIf="item.isItemWorkspace() " ngbDropdownItem (click)="openAddDocument(item)">Add Document</button>
      <button ngbDropdownItem (click)="openModal(propertiesModal, item)">Properties</button>
      <button *ngIf="item.isItemWorkspace() " ngbDropdownItem (click)="openModal(deleteModal, item)">Delete Workspace</button>
      <button *ngIf="item.isItemDocument() " ngbDropdownItem (click)="openModal(deleteModal, item)">Delete Document</button>
    </div>
  </div>
</ng-template>

<ng-template #headerTemplate let-config="config " let-item="item " let-onCollapseExpand="onCollapseExpand " let-onCheckedChange="onCheckedChange " let-onFilterTextChange="onFilterTextChange ">
  <div *ngIf="config.hasFilter " class="row row-filter ">
    <div class="col-12 ">
      <input class="form-control " type="text " [placeholder]="i18n.getFilterPlaceholder() " [(ngModel)]="filterText " (ngModelChange)="onFilterTextChange($event) " />
    </div>
  </div>
  <div *ngIf="config.hasAllCheckBox || config.hasCollapseExpand " class="row ">
    <div class="col-12 ">
      <label *ngIf="config.hasAllCheckBox " (click)="select(item) ">
          <strong>{{ i18n.getAllCheckboxText() }}</strong>
        </label>
      <label *ngIf="config.hasCollapseExpand " class="pull-right " (click)="onCollapseExpand() ">
          <em [title]="i18n.getTooltipCollapseExpandText(item.collapsed) " aria-hidden="true " class="fa " [class.fa-expand]="item.collapsed "
            [class.fa-compress]="!item.collapsed "></em>
        </label>
    </div>
  </div>
  <div *ngIf="config.hasDivider " class="dropdown-divider "></div>
</ng-template>

<ngx-treeview id="treeview" [config]="config " [headerTemplate]="headerTemplate " [items]="items " [itemTemplate]="itemTemplate ">
</ngx-treeview>